<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>WeiFeng AI - Bluetooth Link Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; background: #000; color: #00e5ff; font-family: sans-serif; overflow: hidden; }
        #panel { position: absolute; top: 20px; left: 20px; z-index: 10; background: rgba(15, 15, 15, 0.95); padding: 25px; border-radius: 20px; border: 2px solid #00e5ff; width: 280px; box-shadow: 0 0 15px #00e5ff55; }
        h1 { margin: 0 0 15px 0; font-size: 1.5rem; text-align: center; }
        .status-box { border: 1px solid #333; padding: 12px; font-size: 0.85rem; margin-bottom: 20px; background: #050505; min-height: 60px; color: #ffbc00; }
        button { width: 100%; padding: 15px; margin-bottom: 12px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 1rem; transition: 0.2s; }
        #connectBtn { background: linear-gradient(45deg, #007bff, #00d4ff); color: white; }
        #syncBtn { background: #222; color: #00d4ff; border: 1px solid #00d4ff; }
        button:active { transform: scale(0.95); }
        #canvas-container { width: 100vw; height: 100vh; }
    </style>
</head>
<body>

<div id="panel">
    <h1>WeiFeng AI</h1>
    <div id="status" class="status-box">è«‹ç¢ºä¿é­”æ–¹å·²å–šé†’ï¼ˆè½‰å‹•å¹¾ä¸‹ï¼‰ç„¶å¾Œé»æ“Šä¸‹æ–¹æŒ‰éˆ•ã€‚</div>
    <button id="connectBtn">âš¡ é€£çµæˆ‘çš„ GAN é­”æ–¹</button>
    <button id="syncBtn">ğŸ”„ åŒæ­¥ (æ¨¡å‹å›æ­£)</button>
    <div style="font-size: 0.7rem; color: #555; text-align: center;">WeiFeng AI å°ˆå±¬æ¸¬è©¦å·¥å…·</div>
</div>

<div id="canvas-container"></div>

<script>
    let scene, camera, renderer, cubeGroup;
    const statusDiv = document.getElementById('status');

    // --- 1. 3D åˆå§‹åŒ– ---
    function init3D() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        cubeGroup = new THREE.Group();
        const colors = [0xffffff, 0xffff00, 0xff0000, 0xffa500, 0x00ff00, 0x0000ff];
        for (let x = -1; x <= 1; x++) {
            for (let y = -1; y <= 1; y++) {
                for (let z = -1; z <= 1; z++) {
                    const geometry = new THREE.BoxGeometry(0.9, 0.9, 0.9);
                    const materials = colors.map(c => new THREE.MeshLambertMaterial({ color: c }));
                    const piece = new THREE.Mesh(geometry, materials);
                    piece.position.set(x, y, z);
                    cubeGroup.add(piece);
                }
            }
        }
        scene.add(cubeGroup);
        scene.add(new THREE.AmbientLight(0xffffff, 0.8));
        camera.position.set(4, 4, 5);
        camera.lookAt(0, 0, 0);
        animate();
    }

    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }

    // --- 2. è—ç‰™é€£ç·š (é‡å° Chrome å„ªåŒ–) ---
    document.getElementById('connectBtn').onclick = async () => {
        try {
            statusDiv.style.color = "#ffbc00";
            statusDiv.innerText = "ğŸ” æœå°‹è¨­å‚™ä¸­...\n(è«‹é»é¸åç¨±ç‚º GAN çš„è£ç½®)";
            
            const device = await navigator.bluetooth.requestDevice({
                filters: [{ namePrefix: 'GAN' }],
                optionalServices: [
                    '00001a00-0000-1000-8000-00805f9b34fb',
                    '6e400001-b5a3-f393-e0a9-e50e24dcca9e' // éƒ¨åˆ†æ–°ç‰ˆ GAN å¯èƒ½ä½¿ç”¨çš„æœå‹™
                ]
            });

            statusDiv.innerText = "â³ æ­£åœ¨å»ºç«‹åŠ å¯†é€£ç·š...";
            const server = await device.gatt.connect();
            
            // å˜—è©¦å–å¾—ä¸»æœå‹™
            const service = await server.getPrimaryService('00001a00-0000-1000-8000-00805f9b34fb');
            const char = await service.getCharacteristic('00001a01-0000-1000-8000-00805f9b34fb');

            await char.startNotifications();
            statusDiv.style.color = "#00ff88";
            statusDiv.innerText = "âœ… å·²æˆåŠŸé€£ç·šï¼\nè½‰å‹•é­”æ–¹æ¸¬è©¦çœ‹çœ‹ã€‚";

            char.addEventListener('characteristicvaluechanged', (e) => {
                // æ”¶åˆ°è½‰å‹•æ•¸æ“šæ™‚è®“æ¨¡å‹è½‰å‹•
                cubeGroup.rotation.y += Math.PI / 4;
                statusDiv.innerText = "âš¡ æ”¶åˆ°æ•¸æ“šï¼šé­”æ–¹æ­£åœ¨è½‰å‹•";
            });

            device.addEventListener('gattserverdisconnected', () => {
                statusDiv.style.color = "#ff4444";
                statusDiv.innerText = "âŒ é€£ç·šå·²æ–·é–‹ï¼Œè«‹é‡æ–°é€£çµã€‚";
            });

        } catch (err) {
            statusDiv.style.color = "#ff4444";
            statusDiv.innerText = "âŒ å¤±æ•—ï¼š" + err.message + "\n\næç¤ºï¼šè«‹å˜—è©¦è½‰å‹•é­”æ–¹å¹¾ä¸‹å†è©¦ã€‚";
        }
    };

    // --- 3. åŒæ­¥æŒ‰éˆ• (ä½ æœ€éœ€è¦çš„åŠŸèƒ½) ---
    document.getElementById('syncBtn').onclick = () => {
        cubeGroup.rotation.set(0, 0, 0);
        statusDiv.style.color = "#00d4ff";
        statusDiv.innerText = "ğŸ”„ åŒæ­¥æˆåŠŸï¼š3D æ¨¡å‹å·²å›æ­£";
    };

    init3D();
</script>
</body>
</html>