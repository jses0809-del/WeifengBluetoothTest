<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>WeiFeng AI - Link Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; background: #000; color: #00e5ff; font-family: sans-serif; overflow: hidden; }
        #panel { position: absolute; top: 20px; left: 20px; z-index: 10; background: rgba(15, 15, 15, 0.9); padding: 25px; border-radius: 20px; border: 2px solid #00e5ff; width: 280px; }
        .status-box { border: 1px solid #333; padding: 10px; font-size: 0.8rem; margin-bottom: 20px; background: #000; min-height: 50px; white-space: pre-wrap; word-break: break-all; }
        button { width: 100%; padding: 15px; margin-bottom: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 1rem; }
        #connectBtn { background: linear-gradient(45deg, #007bff, #00e5ff); color: white; }
        #syncBtn { background: #222; color: #00e5ff; border: 1px solid #00e5ff; }
        #canvas-container { width: 100vw; height: 100vh; }
    </style>
</head>
<body>

<div id="panel">
    <h1>WeiFeng AI</h1>
    <div id="status" class="status-box">ç‹€æ…‹ï¼šæº–å‚™å°±ç·’</div>
    <button id="connectBtn">âš¡ é€£çµ GAN é­”æ–¹</button>
    <button id="syncBtn">ğŸ”„ åŒæ­¥ (æ¨¡å‹å›æ­£)</button>
    <div style="font-size: 0.7rem; color: #555;">æç¤ºï¼šè‹¥é€£ç·šå¤±æ•—ï¼Œè«‹å˜—è©¦é‡å•Ÿé­”æ–¹è—ç‰™ï¼ˆæŒ‰ä½é­”æ–¹æˆ–å……é›»ï¼‰</div>
</div>

<div id="canvas-container"></div>

<script>
    let scene, camera, renderer, cubeGroup;
    const statusDiv = document.getElementById('status');

    // --- 3D æ¸²æŸ“ (ç¢ºä¿ä¸å´©æ½°) ---
    function init3D() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        cubeGroup = new THREE.Group();
        const colors = [0xffffff, 0xffff00, 0xff0000, 0xffa500, 0x00ff00, 0x0000ff];
        for (let x = -1; x <= 1; x++) {
            for (let y = -1; y <= 1; y++) {
                for (let z = -1; z <= 1; z++) {
                    const geometry = new THREE.BoxGeometry(0.9, 0.9, 0.9);
                    const materials = colors.map(c => new THREE.MeshLambertMaterial({ color: c }));
                    const piece = new THREE.Mesh(geometry, materials);
                    piece.position.set(x, y, z);
                    cubeGroup.add(piece);
                }
            }
        }
        scene.add(cubeGroup);
        scene.add(new THREE.AmbientLight(0xffffff, 0.8));
        camera.position.set(4, 4, 5);
        camera.lookAt(0, 0, 0);
        animate();
    }

    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }

    // --- å¼·åŒ–ç‰ˆé€£ç·šé‚è¼¯ ---
    document.getElementById('connectBtn').onclick = async () => {
        try {
            statusDiv.innerText = "ğŸ” æ­£åœ¨æœå°‹è¨­å‚™...";
            
            // ä½¿ç”¨ã€Œæ¥å—æ‰€æœ‰è¨­å‚™ã€æ¨¡å¼ä¾†æ¸¬è©¦ï¼Œé€™æœ€ä¸å®¹æ˜“å ± UUID éŒ¯èª¤
            const device = await navigator.bluetooth.requestDevice({
                acceptAllDevices: true,
                optionalServices: ['00001a00-0000-1000-8000-00805f9b34fb', '0000180a-0000-1000-8000-00805f9b34fb']
            });

            statusDiv.innerText = `â³ å˜—è©¦é€£ç·šåˆ°: ${device.name}...`;
            const server = await device.gatt.connect();
            
            // è‡ªå‹•åµæ¸¬å¯ç”¨æœå‹™
            const services = await server.getPrimaryServices();
            statusDiv.innerText = `âœ… é€£ç·šæˆåŠŸï¼\nåµæ¸¬åˆ° ${services.length} å€‹æœå‹™ã€‚`;
            
            // å˜—è©¦å°‹æ‰¾ GAN çš„æ ¸å¿ƒç‰¹å¾µ
            for (const service of services) {
                const chars = await service.getCharacteristics();
                for (const char of chars) {
                    if (char.properties.notify) {
                        await char.startNotifications();
                        char.addEventListener('characteristicvaluechanged', () => {
                            cubeGroup.rotation.y += Math.PI / 4;
                            statusDiv.innerText = "âš¡ æ”¶åˆ°é­”æ–¹è½‰å‹•è¨Šè™Ÿï¼";
                        });
                        statusDiv.innerText = "ğŸŸ¢ æ•¸æ“šé€šé“å·²é–‹å•Ÿï¼Œè½‰è½‰çœ‹ï¼";
                        return;
                    }
                }
            }
        } catch (err) {
            statusDiv.style.color = "#ff4444";
            statusDiv.innerText = "âŒ å¤±æ•—ï¼š" + err.message;
        }
    };

    document.getElementById('syncBtn').onclick = () => {
        cubeGroup.rotation.set(0, 0, 0);
        statusDiv.innerText = "ç‹€æ…‹ï¼šå·²åŸ·è¡ŒåŒæ­¥å›æ­£";
    };

    init3D();
</script>
</body>
</html>