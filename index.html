<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>WeiFeng AI - csTimer Engine Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root { --accent: #00e5ff; }
        body { margin: 0; background: #050505; color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        #ui-layer { position: absolute; top: 20px; left: 20px; z-index: 100; width: 300px; background: rgba(20,20,20,0.9); border: 1px solid var(--accent); border-radius: 12px; padding: 20px; }
        .log-box { height: 120px; background: #000; border: 1px solid #333; margin-top: 15px; padding: 8px; font-family: monospace; font-size: 11px; overflow-y: auto; color: #0f0; }
        button { width: 100%; padding: 12px; margin-top: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; background: var(--accent); color: #000; }
        #syncBtn { background: #333; color: var(--accent); border: 1px solid var(--accent); }
        #timer-val { font-size: 3rem; text-align: center; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>

<div id="ui-layer">
    <h2 style="margin:0; font-size:1.2rem; color:var(--accent);">WeiFeng AI Engine</h2>
    <div id="timer-val">00.00</div>
    <button id="connectBtn">‚ö° ÈÄ£ÁµêÊô∫ËÉΩÈ≠îÊñπ (GAN)</button>
    <button id="syncBtn">üîÑ ÁãÄÊÖãÂêåÊ≠•</button>
    <div class="log-box" id="debugLog">Á≥ªÁµ±Â∞±Á∑í...ÂèÉËÄÉ csTimer ÂçîË≠∞„ÄÇ</div>
</div>

<div id="canvas-container"></div>

<script>
    let scene, camera, renderer, cube;
    const logEl = document.getElementById('debugLog');
    
    function log(msg) {
        logEl.innerHTML += `<div>> ${msg}</div>`;
        logEl.scrollTop = logEl.scrollHeight;
    }

    // --- 3D Ë¶ñË¶∫ (csTimer È¢®Ê†º) ---
    function initVisuals() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const group = new THREE.Group();
        const colors = [0xffffff, 0xffff00, 0xff0000, 0xffa500, 0x00ff00, 0x0000ff];
        for (let x = -1; x <= 1; x++) {
            for (let y = -1; y <= 1; y++) {
                for (let z = -1; z <= 1; z++) {
                    const mesh = new THREE.Mesh(
                        new THREE.BoxGeometry(0.9, 0.9, 0.9),
                        colors.map(c => new THREE.MeshLambertMaterial({color: c}))
                    );
                    mesh.position.set(x, y, z);
                    group.add(mesh);
                }
            }
        }
        cube = group;
        scene.add(cube);
        scene.add(new THREE.AmbientLight(0xffffff, 0.9));
        camera.position.set(3, 3, 5);
        camera.lookAt(0,0,0);
        
        function animate() { requestAnimationFrame(animate); renderer.render(scene, camera); }
        animate();
    }

    // --- ËóçÁâôÈÇèËºØ (ÂèÉËÄÉ csTimer Êè°Êâã) ---
    document.getElementById('connectBtn').onclick = async () => {
        try {
            log("Ê≠£Âú®ÊêúÂ∞ã GAN Ë®≠ÂÇô...");
            const device = await navigator.bluetooth.requestDevice({
                filters: [{ namePrefix: 'GAN' }],
                optionalServices: [
                    '00001a00-0000-1000-8000-00805f9b34fb', 
                    '6e400001-b5a3-f393-e0a9-e50e24dcca9e'
                ]
            });

            log("Ë®≠ÂÇôÂ∑≤ÊâæÂà∞ÔºåÊ≠£Âú®Âª∫Á´ãÂÆâÂÖ®ÈÄ£Á∑ö...");
            const server = await device.gatt.connect();
            
            // ÂòóË©¶ÂÅµÊ∏¨ csTimer ‰∏≠ÊèêÂà∞ÁöÑÊâÄÊúâÂèØËÉΩÊúçÂãô
            const service = await server.getPrimaryService('00001a00-0000-1000-8000-00805f9b34fb');
            const characteristic = await service.getCharacteristic('00001a01-0000-1000-8000-00805f9b34fb');

            await characteristic.startNotifications();
            log("‚úÖ ÈÄ£Á∑öÊàêÂäüÔºÅÁõ£ËÅΩÊï∏Êìö‰∏≠...");

            characteristic.addEventListener('characteristicvaluechanged', (e) => {
                const val = e.target.value;
                // Ê≠§ËôïÊú™‰æÜÈúÄÂä†ÂÖ• AES Ëß£ÂØÜÈÄªËæë (ÂèÉËÄÉ csTimer src/js/bluetooth/gan.js)
                log(`Êî∂Âà∞Âä†ÂØÜÂåÖ: ${val.byteLength} bytes`);
                cube.rotation.y += 0.5; // Êö´ÊôÇÁî®Ë¶ñË¶∫ÂèçÈ•ã
            });

        } catch (err) {
            log(`‚ùå ÈåØË™§: ${err.message}`);
        }
    };

    document.getElementById('syncBtn').onclick = () => {
        cube.rotation.set(0, 0, 0);
        log("Ê®°ÂûãÂ∑≤ÈáçÁΩÆÊ≠∏‰Ωç„ÄÇ");
    };

    initVisuals();
</script>
</body>
</html>